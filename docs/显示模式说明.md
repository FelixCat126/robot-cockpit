# 显示模式说明

系统支持两种显示模式，根据环境自动切换或手动配置。

## 1. 单显示器模式（Single Display Mode）

### 用途
用于开发和测试环境，在单个显示器上模拟多屏效果。

### 配置
在 `.env` 文件中设置：
```env
SINGLE_DISPLAY_MODE=true
SCREEN_AUTO_START=true
```

### 运行效果
- **窗口模式**：每个屏幕以独立窗口显示
- **窗口大小**：800x600（可配置）
- **窗口布局**：自动并排排列，每行3个窗口
- **窗口位置**：自动计算，避免重叠
- **全屏**：不启用全屏模式

### 示例布局
```
[窗口0] [窗口1] [窗口2]
[窗口3] [窗口4] [窗口5]
[窗口6]
```

### 适用场景
- 开发调试
- 单显示器环境测试
- 功能验证

---

## 2. 多显示器模式（Multi Display Mode）

### 用途
生产环境，在多个物理显示器上分别显示不同内容。

### 配置
在 `.env` 文件中设置：
```env
SINGLE_DISPLAY_MODE=false
# 或直接不设置该变量（默认为false）
SCREEN_AUTO_START=true
```

### 运行效果
- **全屏模式**：每个显示器上全屏显示
- **自动定位**：浏览器窗口自动定位到对应的物理显示器
- **显示器检测**：自动检测所有连接的显示器
- **窗口大小**：匹配显示器的实际分辨率
- **Kiosk模式**：启用浏览器Kiosk模式，隐藏浏览器UI

### 显示器映射
系统会自动检测显示器，并按顺序映射：
- 屏幕0 → 显示器0（主显示器）
- 屏幕1 → 显示器1
- 屏幕2 → 显示器2
- ... 依此类推

### 显示器检测
使用 `xrandr --listmonitors` 命令检测显示器，获取：
- 显示器名称（如 HDMI-0, DP-1）
- 分辨率（width x height）
- 位置坐标（x, y）

### 适用场景
- 生产环境部署
- 多屏监控系统
- 机器人驾驶舱显示

---

## 模式切换

### 方法1：环境变量
```bash
# 单显示器模式
export SINGLE_DISPLAY_MODE=true
npm start

# 多显示器模式
export SINGLE_DISPLAY_MODE=false
npm start
```

### 方法2：配置文件
编辑 `.env` 文件：
```env
# 单显示器模式
SINGLE_DISPLAY_MODE=true

# 多显示器模式
SINGLE_DISPLAY_MODE=false
```

---

## 技术实现

### 单显示器模式
1. 移除浏览器全屏参数（`--kiosk`, `--start-fullscreen`）
2. 设置较小的窗口尺寸（800x600）
3. 使用CDP协议设置窗口位置（并排排列）
4. 不请求页面全屏

### 多显示器模式
1. 保留浏览器全屏参数
2. 添加窗口位置参数（`--window-position=x,y`）
3. 使用CDP协议精确定位窗口到对应显示器
4. 请求页面全屏
5. 窗口大小匹配显示器分辨率

---

## 故障排除

### 单显示器模式下窗口重叠
- 检查窗口大小配置（`singleDisplayWindow.width/height`）
- 检查窗口间距配置（`singleDisplayWindow.gap`）
- 手动调整窗口位置

### 多显示器模式下窗口不在正确显示器
- 检查显示器检测：`xrandr --listmonitors`
- 检查显示器配置：`xrandr --output HDMI-0 --mode 1920x1080 --pos 0x0`
- 查看日志中的窗口定位信息

### 全屏不生效
- 检查浏览器是否支持CDP协议
- 检查系统权限（某些系统需要特殊权限）
- 查看浏览器控制台错误信息

---

## 配置示例

### 单显示器模式配置
```env
SINGLE_DISPLAY_MODE=true
SCREEN_AUTO_START=true
SCREEN_COUNT=7
FRONTEND_URL=http://localhost:5173
```

### 多显示器模式配置
```env
SINGLE_DISPLAY_MODE=false
SCREEN_AUTO_START=true
SCREEN_COUNT=7
FRONTEND_URL=http://localhost:3000
```

