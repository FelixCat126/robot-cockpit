# Robot Cockpit - 机器人驾驶舱系统

多屏Web应用，用于在Ubuntu系统上显示ROS2机器人数据，支持7个屏幕独立显示不同内容。

## 架构设计

### 模块化设计

系统采用模块化、解耦的架构设计：

1. **ROS2 Bridge模块** (`backend/modules/ros2-bridge/`)
   - 独立模块，负责与ROS2 Bridge通信
   - 可替换不同的ROS2 Bridge实现
   - 支持订阅、发布、服务调用

2. **WebSocket服务模块** (`backend/modules/websocket/`)
   - 独立的数据传输层
   - 连接ROS2数据和前端应用
   - 支持多客户端连接

3. **屏幕管理模块** (`backend/modules/screen-manager/`)
   - 独立的屏幕控制服务
   - 自动检测和管理多个显示器
   - 使用Puppeteer控制浏览器实例

4. **前端应用** (`frontend/`)
   - React + TypeScript
   - 7个独立的屏幕组件
   - WebSocket客户端服务

## 项目结构

```
robot-cockpit/
├── backend/                      # 后端服务
│   ├── config/                  # 配置文件
│   │   └── index.js             # 统一配置管理
│   ├── modules/                  # 功能模块
│   │   ├── ros2-bridge/        # ROS2 Bridge集成
│   │   │   └── ROS2Bridge.js
│   │   ├── websocket/          # WebSocket服务
│   │   │   └── WebSocketService.js
│   │   └── screen-manager/      # 屏幕管理
│   │       └── ScreenManager.js
│   └── server.js                # Express主服务器
├── frontend/                     # 前端应用
│   ├── src/
│   │   ├── screens/            # 7个屏幕组件
│   │   ├── services/           # 服务层
│   │   │   └── websocket.ts
│   │   ├── hooks/              # React Hooks
│   │   │   └── useWebSocket.ts
│   │   ├── utils/              # 工具函数
│   │   │   ├── fullscreen.ts
│   │   │   └── screenId.ts
│   │   └── App.tsx
│   └── package.json
└── package.json
```

## 安装和运行

### 前置要求

- Node.js >= 16
- Ubuntu Linux
- ROS2 (已安装rosbridge_suite)
- Chromium/Chrome浏览器
- X11显示服务器

### 安装依赖

```bash
# 安装所有依赖
npm run install:all

# 或分别安装
npm install
cd frontend && npm install
```

### 配置

创建 `.env` 文件（可选）：

```env
# 服务器配置
PORT=3000
HOST=0.0.0.0

# ROS2 Bridge配置
ROS2_BRIDGE_URL=ws://localhost:9090
ROS2_TOPICS=/robot/status,/robot/telemetry,/robot/commands

# 屏幕配置
SCREEN_COUNT=7
FRONTEND_URL=http://localhost:5173

# WebSocket配置
CORS_ORIGIN=*
```

### 开发模式

```bash
# 同时启动后端和前端
npm run dev

# 或分别启动
npm run dev:backend  # 后端
npm run dev:frontend # 前端
```

### 生产模式

```bash
# 构建前端
npm run build

# 启动服务器
npm start
```

## API接口

### 健康检查
```
GET /api/health
```

### ROS2状态
```
GET /api/ros2/status
```

### 屏幕管理
```
GET /api/screens                    # 获取所有屏幕状态
POST /api/screens/:screenId/start   # 启动指定屏幕
POST /api/screens/:screenId/stop    # 停止指定屏幕
POST /api/screens/:screenId/restart # 重启指定屏幕
```

## WebSocket事件

### 客户端发送

- `register_screen` - 注册屏幕ID
- `subscribe_topic` - 订阅ROS2话题
- `unsubscribe_topic` - 取消订阅
- `publish_topic` - 发布消息到ROS2话题
- `ping` - 心跳

### 服务器发送

- `topic_data` - ROS2话题数据
- `screen_registered` - 屏幕注册响应
- `pong` - 心跳响应

## 屏幕配置

系统支持7个屏幕（ID: 0-6），每个屏幕通过URL参数识别：

- 屏幕0: `http://localhost:5173?screen=0`
- 屏幕1: `http://localhost:5173?screen=1`
- ...
- 屏幕6: `http://localhost:5173?screen=6`

## 开机自启动

创建systemd服务文件（待实现）：

```bash
sudo cp systemd/robot-cockpit.service /etc/systemd/system/
sudo systemctl enable robot-cockpit
sudo systemctl start robot-cockpit
```

## 开发说明

### 模块解耦原则

1. **ROS2 Bridge模块**：独立于Web服务器，只负责ROS2通信
2. **WebSocket服务**：独立的数据传输层，不依赖ROS2实现细节
3. **屏幕管理**：独立的屏幕控制，可替换不同的浏览器控制方案
4. **前端服务**：独立的WebSocket客户端，可连接任何WebSocket服务器

### 扩展新功能

1. 添加新的ROS2话题：修改 `backend/config/index.js` 中的 `topics` 配置
2. 添加新屏幕组件：在 `frontend/src/screens/` 创建新组件，在 `App.tsx` 中注册
3. 替换ROS2 Bridge：实现相同的接口，替换 `ROS2Bridge.js`

## 许可证

MIT

