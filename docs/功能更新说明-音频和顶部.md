# åŠŸèƒ½æ›´æ–°è¯´æ˜ - éŸ³é¢‘å’Œé¡¶éƒ¨ä¼˜åŒ–

## æ›´æ–°æ—¥æœŸ
2025-12-09

## æ›´æ–°å†…å®¹

### 1. éŸ³é¢‘é€šä¿¡åŠŸèƒ½å¢å¼º âœ…

#### 1.1 éº¦å…‹é£è¾“å…¥æ§åˆ¶
- **åŠŸèƒ½**ï¼šå¯æ§åˆ¶å¼€å¯/å…³é—­éº¦å…‹é£
- **æŒ‰é’®**ï¼šğŸ¤/ğŸ™ï¸ å›¾æ ‡åˆ‡æ¢
- **çŠ¶æ€æç¤º**ï¼šå¼€å¯åæ˜¾ç¤º"ğŸ¤ å½•éŸ³ä¸­"çº¢è‰²è„‰åŠ¨å¾½ç« 
- **æƒé™å¤„ç†**ï¼šé¦–æ¬¡ä½¿ç”¨ä¼šè¯·æ±‚æµè§ˆå™¨éº¦å…‹é£æƒé™

#### 1.2 éŸ³é¢‘æ’­æ”¾åŠŸèƒ½ï¼ˆè°ƒè¯•é˜¶æ®µï¼‰
- **åŠŸèƒ½**ï¼šå¯æ’­æ”¾éŸ³é¢‘æµ
- **è°ƒè¯•æ¨¡å¼**ï¼šå½“å‰å›æ”¾æœ¬åœ°éº¦å…‹é£éŸ³é¢‘ï¼ˆç”¨äºæµ‹è¯•ï¼‰
- **æŒ‰é’®**ï¼šâ–¶ï¸/â¹ï¸ æ’­æ”¾/åœæ­¢åˆ‡æ¢
- **çŠ¶æ€æç¤º**ï¼šæ’­æ”¾æ—¶æ˜¾ç¤º"ğŸ”Š æ’­æ”¾ä¸­"ç»¿è‰²è„‰åŠ¨å¾½ç« 
- **ä¾èµ–å…³ç³»**ï¼šå¿…é¡»å…ˆå¼€å¯éº¦å…‹é£æ‰èƒ½æ’­æ”¾

#### 1.3 å®æ—¶æ³¢å½¢å¯è§†åŒ–
- **éº¦å…‹é£å¼€å¯æ—¶**ï¼šéŸ³é¢‘æ¡å®æ—¶æ˜¾ç¤ºéº¦å…‹é£è¾“å…¥é¢‘è°±
- **éº¦å…‹é£å…³é—­æ—¶**ï¼šæ˜¾ç¤ºæ¨¡æ‹Ÿæ³¢å½¢åŠ¨ç”»
- **æŠ€æœ¯å®ç°**ï¼šä½¿ç”¨Web Audio APIçš„AnalyserNode

#### 1.4 ä½¿ç”¨æµç¨‹
```
1. ç‚¹å‡»ğŸ™ï¸æŒ‰é’® â†’ æˆæƒéº¦å…‹é£ â†’ æ˜¾ç¤ºğŸ¤å½•éŸ³ä¸­
2. éŸ³é¢‘æ¡å¼€å§‹æ˜¾ç¤ºå®æ—¶é¢‘è°±
3. ç‚¹å‡»â–¶ï¸æŒ‰é’® â†’ å¼€å§‹æ’­æ”¾ï¼ˆè°ƒè¯•ï¼šå›æ”¾æœ¬åœ°éŸ³é¢‘ï¼‰
4. ç‚¹å‡»â¹ï¸æŒ‰é’® â†’ åœæ­¢æ’­æ”¾
5. ç‚¹å‡»ğŸ¤æŒ‰é’® â†’ å…³é—­éº¦å…‹é£
```

### 2. ç§»é™¤å¤–è®¾è°ƒè¯•æŒ‰é’® âœ…

#### 2.1 ç§»é™¤å†…å®¹
- âŒ "ğŸ® æ˜¾ç¤ºå¤–è®¾è°ƒè¯•"åˆ‡æ¢æŒ‰é’®
- âŒ å¤–è®¾è°ƒè¯•é¢æ¿(PeripheralDebugPanel)
- âŒ ç›¸å…³çŠ¶æ€ç®¡ç†ä»£ç 

#### 2.2 ä¿ç•™å†…å®¹
- âœ… å¤–è®¾æ§åˆ¶å™¨æ ¸å¿ƒåŠŸèƒ½(PeripheralController)
- âœ… æ‰‹æŸ„/æ‘‡æ†æ§åˆ¶æœºå™¨äººçš„èƒ½åŠ›
- âœ… å¤–è®¾å‘½ä»¤å¤„ç†é€»è¾‘

### 3. é¡¶éƒ¨å¯¼èˆªæ ä¼˜åŒ– âœ…

#### 3.1 å…¬å¸åç§°æ˜¾ç¤º
- **ä½ç½®**ï¼šé¡¶éƒ¨å·¦ä¾§
- **æ ¼å¼**ï¼š
  ```
  ğŸ¤– éº¦æ“ç§‘æŠ€
     æœºå™¨äººé©¾é©¶èˆ±
  ```
- **æ ·å¼**ï¼š
  - å…¬å¸åï¼š22px ç»¿è‰²å­—ä½“
  - å‰¯æ ‡é¢˜ï¼š12px ç°è‰²å­—ä½“

#### 3.2 ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
- **ä½ç½®**ï¼šé¡¶éƒ¨å³ä¾§ï¼ˆæŒ‰é’®åŒºåŸŸå·¦è¾¹ï¼‰
- **å†…å®¹**ï¼šğŸ‘¤ ç”¨æˆ·å
- **æ ·å¼**ï¼šè“è‰²èƒŒæ™¯å¡ç‰‡ï¼Œå¸¦è¾¹æ¡†
- **æ•°æ®æ¥æº**ï¼šä»authStoreè·å–username

#### 3.3 å¸ƒå±€ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– éº¦æ“ç§‘æŠ€         ğŸ”‹85% ğŸŸ¢å·²è¿æ¥ ğŸŒ¡ï¸42Â°C      ğŸ‘¤ç”¨æˆ· ğŸ”„ğŸšª â”‚
â”‚    æœºå™¨äººé©¾é©¶èˆ±      æ§åˆ¶ä¸­: robot-001                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯å®ç°ç»†èŠ‚

### éŸ³é¢‘åŠŸèƒ½

#### Web Audio APIæ¶æ„
```typescript
// éŸ³é¢‘ä¸Šä¸‹æ–‡
const audioContext = new AudioContext();

// åˆ†æå™¨ï¼ˆç”¨äºæ³¢å½¢å¯è§†åŒ–ï¼‰
const analyser = audioContext.createAnalyser();
analyser.fftSize = 256;

// éŸ³é¢‘ç›®æ ‡ï¼ˆç”¨äºå›æ”¾ï¼‰
const destination = audioContext.createMediaStreamDestination();

// éº¦å…‹é£æº â†’ åˆ†æå™¨ & ç›®æ ‡
source.connect(analyser);
source.connect(destination);
```

#### é¢‘è°±å¯è§†åŒ–
```typescript
const dataArray = new Uint8Array(bufferLength);
analyser.getByteFrequencyData(dataArray);

// æ›´æ–°éŸ³é¢‘æ¡é«˜åº¦
bars.forEach((bar, index) => {
  const value = dataArray[dataIndex];
  const height = (value / 255) * 100;
  bar.style.height = `${height}%`;
});
```

#### è°ƒè¯•å›æ”¾
```typescript
// åˆ›å»ºAudioå…ƒç´ æ’­æ”¾æœ¬åœ°éŸ³é¢‘
const audioElement = new Audio();
audioElement.srcObject = destination.stream;
audioElement.play();
```

### ç”¨æˆ·åå­˜å‚¨

#### authStoreå¢å¼º
```typescript
interface AuthState {
  username: string | null;  // æ–°å¢
  // ... å…¶ä»–å­—æ®µ
}

// ç™»å½•æ—¶ä¿å­˜
localStorage.setItem('robot_cockpit_username', username);

// ç™»å‡ºæ—¶æ¸…é™¤
localStorage.removeItem('robot_cockpit_username');
```

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
1. `frontend/src/components/shared/AudioPlayer.tsx`
   - æ·»åŠ éº¦å…‹é£å¼€å…³åŠŸèƒ½
   - æ·»åŠ éŸ³é¢‘æ’­æ”¾åŠŸèƒ½
   - æ·»åŠ å®æ—¶é¢‘è°±å¯è§†åŒ–
   - æ·»åŠ çŠ¶æ€å¾½ç« 

2. `frontend/src/components/shared/ControlPanel.tsx`
   - ç§»é™¤å¤–è®¾è°ƒè¯•æŒ‰é’®å’Œé¢æ¿
   - ç§»é™¤ç›¸å…³çŠ¶æ€ç®¡ç†
   - æ¸…ç†æœªä½¿ç”¨çš„å¯¼å…¥

3. `frontend/src/layouts/SingleScreenLayout.tsx`
   - ä¿®æ”¹é¡¶éƒ¨å¯¼èˆªæ ç»“æ„
   - æ·»åŠ å…¬å¸åç§°æ˜¾ç¤º
   - æ·»åŠ ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
   - ä»authStoreè·å–username

4. `frontend/src/layouts/SingleScreenLayout.css`
   - æ·»åŠ company-sectionæ ·å¼
   - æ·»åŠ user-infoæ ·å¼
   - ä¼˜åŒ–æ ‡é¢˜å’Œå‰¯æ ‡é¢˜å¸ƒå±€

5. `frontend/src/stores/authStore.ts`
   - æ·»åŠ usernameå­—æ®µ
   - ç™»å½•æ—¶ä¿å­˜username
   - ç™»å‡ºæ—¶æ¸…é™¤username

6. `frontend/src/components/shared/CompactStyles.css`
   - æ·»åŠ æ’­æ”¾å¾½ç« åŠ¨ç”»
   - æ·»åŠ disabledæŒ‰é’®æ ·å¼

7. `frontend/src/screens/Screen0.tsx`
   - ç§»é™¤showPeripheralDebugå±æ€§

## CSSæ ·å¼è¯´æ˜

### éŸ³é¢‘ç›¸å…³

```css
/* æ’­æ”¾æ¿€æ´»å¾½ç«  */
.streaming-badge.playback-active {
  background: rgba(16, 185, 129, 0.2);
  border: 1px solid rgba(16, 185, 129, 0.5);
  color: #10b981;
  animation: playbackPulse 1.5s infinite;
}

/* æ’­æ”¾è„‰åŠ¨åŠ¨ç”» */
@keyframes playbackPulse {
  0%, 100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.7;
    transform: scale(1.05);
  }
}

/* ç¦ç”¨æŒ‰é’® */
.control-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}
```

### é¡¶éƒ¨å¯¼èˆªç›¸å…³

```css
/* å…¬å¸åŒºåŸŸ */
.company-section {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.subtitle {
  font-size: 12px;
  color: #64748b;
  margin-left: 28px;
}

/* ç”¨æˆ·ä¿¡æ¯ */
.user-info {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  background: rgba(59, 130, 246, 0.1);
  border: 1px solid rgba(59, 130, 246, 0.3);
  border-radius: 6px;
}

.username {
  font-size: 14px;
  font-weight: 500;
  color: #60a5fa;
}
```

## åç»­å¼€å‘è®¡åˆ’

### éŸ³é¢‘åŠŸèƒ½å®Œå–„
1. **çœŸå®éŸ³é¢‘æµå¯¹æ¥**
   - å°†éº¦å…‹é£éŸ³é¢‘å‘é€åˆ°åç«¯
   - æ¥æ”¶å¯¹ç«¯éŸ³é¢‘æµå¹¶æ’­æ”¾
   - å®ç°åŒå‘éŸ³é¢‘é€šä¿¡

2. **éŸ³é¢‘è´¨é‡ä¼˜åŒ–**
   - æ·»åŠ å›å£°æ¶ˆé™¤
   - æ·»åŠ å™ªéŸ³æŠ‘åˆ¶
   - æ”¯æŒéŸ³é¢‘ç¼–ç é…ç½®

3. **åŠŸèƒ½å¢å¼º**
   - æ·»åŠ éŸ³é‡è°ƒèŠ‚æ»‘å—
   - æ·»åŠ éŸ³é¢‘å½•åˆ¶åŠŸèƒ½
   - æ·»åŠ éŸ³é¢‘æ ¼å¼é€‰æ‹©

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
1. **æƒé™å¼•å¯¼**
   - é¦–æ¬¡ä½¿ç”¨æ·»åŠ å¼•å¯¼æç¤º
   - æƒé™è¢«æ‹’ç»æ—¶çš„å‹å¥½æç¤º

2. **çŠ¶æ€æŒä¹…åŒ–**
   - è®°ä½éº¦å…‹é£å¼€å…³çŠ¶æ€
   - è®°ä½éŸ³é‡è®¾ç½®

## æµ‹è¯•å»ºè®®

### 1. éŸ³é¢‘åŠŸèƒ½æµ‹è¯•
- [ ] éº¦å…‹é£æƒé™è¯·æ±‚
- [ ] éº¦å…‹é£å¼€å…³åˆ‡æ¢
- [ ] å®æ—¶æ³¢å½¢æ˜¾ç¤º
- [ ] æ’­æ”¾åŠŸèƒ½ï¼ˆæœ¬åœ°å›æ”¾ï¼‰
- [ ] æŒ‰é’®ç¦ç”¨çŠ¶æ€
- [ ] çŠ¶æ€å¾½ç« æ˜¾ç¤º

### 2. ç•Œé¢æµ‹è¯•
- [ ] å…¬å¸åç§°æ˜¾ç¤ºæ­£ç¡®
- [ ] ç”¨æˆ·åæ˜¾ç¤ºæ­£ç¡®
- [ ] ç™»å‡ºåç”¨æˆ·åæ¸…é™¤
- [ ] å¤–è®¾è°ƒè¯•æŒ‰é’®å·²ç§»é™¤
- [ ] å¸ƒå±€æ²¡æœ‰é”™ä½

### 3. å…¼å®¹æ€§æµ‹è¯•
- [ ] Chromeæµè§ˆå™¨
- [ ] Safariæµè§ˆå™¨ï¼ˆéœ€HTTPSï¼‰
- [ ] ä¸åŒå±å¹•åˆ†è¾¨ç‡

## æ³¨æ„äº‹é¡¹

1. **HTTPSè¦æ±‚**
   - éº¦å…‹é£åŠŸèƒ½åœ¨ç”Ÿäº§ç¯å¢ƒéœ€è¦HTTPS
   - localhostå¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨HTTP

2. **æµè§ˆå™¨å…¼å®¹æ€§**
   - Web Audio APIæ”¯æŒï¼šChromeã€Firefoxã€Safari
   - getUserMediaæ”¯æŒï¼šç°ä»£æµè§ˆå™¨å‡æ”¯æŒ

3. **æ€§èƒ½è€ƒè™‘**
   - é¢‘è°±åˆ†æä½¿ç”¨requestAnimationFrame
   - é¿å…è¿‡é«˜çš„FFTå°ºå¯¸ï¼ˆå½“å‰256å·²ä¼˜åŒ–ï¼‰

4. **ç”¨æˆ·åå­˜å‚¨**
   - ä½¿ç”¨localStorageå­˜å‚¨
   - æ³¨æ„æ¸…ç†æ—¶åŒæ­¥æ¸…é™¤

## ç›¸å…³æ–‡æ¡£
- [éŸ³é¢‘æ’­æ”¾å™¨ç»„ä»¶](../frontend/src/components/shared/AudioPlayer.tsx)
- [Web Audio APIæ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)
- [getUserMediaæ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)
