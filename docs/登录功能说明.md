# 登录功能说明

## 📋 功能概述

系统实现了登录认证功能，所有屏幕在启动时会显示登录页面，但只有指定的触摸屏可以输入用户名和密码进行登录。

## 🎯 功能特点

1. **多屏显示登录页面**：所有7个屏幕都会显示登录页面
2. **单屏输入**：只有配置的触摸屏（默认屏幕0）可以输入用户名和密码
3. **远端认证**：支持调用远端认证API进行用户验证
4. **模拟认证**：支持模拟认证模式，用于开发和测试

## 🔧 配置说明

### 触摸屏配置

在 `.env` 文件中配置触摸屏ID（可以输入用户名密码的屏幕）：

```env
# 触摸屏ID（0-6），默认为0
VITE_TOUCH_SCREEN_ID=0
```

### 认证模式配置

#### 1. 模拟认证模式（默认）

```env
# 使用模拟认证（推荐用于开发和测试）
USE_MOCK_AUTH=true
```

**测试账号：**
- 用户名: `admin`，密码: `admin123`
- 用户名: `user`，密码: `user123`
- 用户名: `test`，密码: `test123`

**模拟行为：**
- 使用测试账号：登录成功
- 其他账号：50%概率返回"用户名或密码错误"，50%概率返回"服务器错误"

#### 2. 远端认证模式

```env
# 使用远端认证API
USE_MOCK_AUTH=false
AUTH_API_URL=https://your-auth-api.com/login
```

**API要求：**
- 方法：POST
- Content-Type: application/json
- 请求体：`{ "username": "xxx", "password": "xxx" }`
- 成功响应：`{ "success": true, "token": "xxx" }`
- 失败响应：返回错误状态码或 `{ "success": false, "message": "xxx" }`

## 🖥️ 界面说明

### 触摸屏界面（可输入）

- 显示登录表单
- 用户名输入框
- 密码输入框
- 登录按钮
- 错误提示（如果登录失败）

### 非触摸屏界面（只显示）

- 显示"等待登录"提示
- 显示当前屏幕编号
- 提示用户在触摸屏上登录

## 📡 API接口

### 登录接口

**端点：** `POST /api/auth/login`

**请求体：**
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**成功响应（200）：**
```json
{
  "success": true,
  "token": "base64_encoded_token",
  "message": "登录成功"
}
```

**失败响应（401）：**
```json
{
  "success": false,
  "message": "用户名或密码错误"
}
```

**服务器错误（500）：**
```json
{
  "success": false,
  "message": "认证服务错误，请稍后重试"
}
```

## 🔄 登录流程

1. **系统启动**
   - 所有屏幕显示登录页面
   - 触摸屏显示登录表单
   - 其他屏幕显示等待提示

2. **用户输入**
   - 用户在触摸屏上输入用户名和密码
   - 点击登录按钮

3. **认证处理**
   - 前端发送登录请求到后端
   - 后端调用认证服务（模拟或远端）
   - 返回认证结果

4. **登录成功**
   - 保存token到localStorage
   - 更新认证状态
   - 所有屏幕自动切换到对应的内容页面

5. **登录失败**
   - 显示错误提示
   - 用户可以重新输入

## 💾 状态管理

登录状态保存在：
- `localStorage`: `robot_cockpit_logged_in` = `'true'`
- `localStorage`: `robot_cockpit_token` = token值

## 🧪 测试方法

### 测试登录成功

```bash
# 使用测试账号
用户名: admin
密码: admin123
```

### 测试登录失败

```bash
# 使用错误密码
用户名: admin
密码: wrongpassword
```

### 测试服务器错误

```bash
# 使用随机账号（模拟模式）
用户名: random
密码: random
# 有50%概率返回服务器错误
```

## 🔒 安全说明

当前实现为演示版本，实际生产环境需要：

1. **使用HTTPS**：保护密码传输
2. **JWT Token**：使用标准的JWT token而不是base64编码
3. **Token过期**：实现token过期和刷新机制
4. **密码加密**：密码不应明文传输（使用HTTPS）
5. **防暴力破解**：实现登录失败次数限制
6. **会话管理**：实现会话超时和自动登出

## 📝 代码结构

```
frontend/src/
├── components/
│   ├── LoginPage.tsx      # 登录页面组件
│   └── LoginPage.css      # 登录页面样式
├── services/
│   └── auth.ts            # 认证服务
└── stores/
    └── authStore.ts      # 认证状态管理

backend/
└── server.js             # 认证API端点
```

## 🐛 故障排除

### 登录页面不显示

- 检查浏览器控制台是否有错误
- 确认前端已正确构建
- 检查路由配置

### 登录请求失败

- 检查后端服务是否运行
- 检查API端点是否正确
- 查看后端日志

### 认证状态不保存

- 检查浏览器localStorage是否可用
- 检查token是否正确返回
- 查看浏览器控制台错误

